@page
@model PlantsInformationWeb.Pages.Admin.PlantManagement
@using Microsoft.AspNetCore.Authorization
@attribute [Authorize(Roles = "admin")]
@{
    Layout = "_LayoutAdmin";
    ViewData["Title"] = "Plant Management";
}

                <!-- Plant Management Section -->
                <div id="plants-section" class="content-section">
                    <div
                        class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2 text-success">Plant Management</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <button type="button" class="btn btn-success btn-sm me-2" data-bs-toggle="modal"
                                data-bs-target="#addPlantModal">
                                <i class="bi bi-plus-circle me-1"></i>Add Plant
                            </button>
                        </div>
                    </div>

                    <!-- Plant Filters -->
                    <div class="row mb-3">
                    <form method="get" class="row mb-3">
                        <div class="col-md-4">
                            <input type="text" name="search" id="plantSearch" value="@Request.Query["search"]" class="form-control" placeholder="Plant disease..." />
                        </div>
                        <div class="col-md-3">
                            @{
                                var selectedCategoryId = Request.Query["categoryId"].ToString();
                            }
                            <select class="form-select" id="plantCategoryFilter" name="categoryId">
                                @* Option All Categories*@
                                @if (string.IsNullOrEmpty(selectedCategoryId))
                                {
                                    <option value="" selected>All Categories</option>
                                }
                                else
                                {
                                    <option value="">All Categories</option>
                                }
                                @* Các loại cây *@
                                @foreach (var category in Model.CategoriesWithCount)
                                {
                                    if (selectedCategoryId == category.CategoryId.ToString())
                                    {
                                        <option value="@category.CategoryId" selected>@category.CategoryName</option>
                                    }
                                    else
                                    {
                                        <option value="@category.CategoryId">@category.CategoryName</option>
                                    }
                                }
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button type="submit" class="btn btn-success">Search</button>
                        </div>
                    </form>
                </div>

                    <!-- Plants Table -->
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="plantsTable">
                                    <thead>
                                        <tr>
                                            <th data-bs-toggle="tooltip" title="Click to sort">Image</th>
                                            <th data-bs-toggle="tooltip" title="Click to sort">Plant Name</th>
                                            <th data-bs-toggle="tooltip" title="Click to sort">Scientific Name</th>
                                            <th data-bs-toggle="tooltip" title="Click to sort">Category</th>
                                            <th data-bs-toggle="tooltip" title="Click to sort">Created At</th>
                                            <th data-bs-toggle="tooltip" title="Click to sort">Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var plant in Model.PlantSummaries)
                                        {
                                            <tr>
                                                <td>
                                                    @if (!string.IsNullOrEmpty(plant.ThumbnailUrl))
                                                    {
                                                        <img src="@plant.ThumbnailUrl" alt="@plant.PlantName"
                                                            class="plant-thumb" width="60" height="60" />
                                                    }   
                                                    else
                                                    {
                                                        <span class="text-muted">No image</span>
                                                    }
                                                </td>
                                                <td>@plant.PlantName</td>
                                                <td><em>@plant.ScientificName</em></td>
                                                <td>
                                                    <span class="badge bg-success">@plant.CategoryName</span>
                                                </td>
                                                <td>@plant.CreatedAt?.ToString("yyyy-MM-dd")</td>
                                                <td>
                                                    <span
                                                        class="badge @(plant.Status == "Active" ? "bg-success" : "bg-secondary")">
                                                        @plant.Status
                                                    </span>
                                                </td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-primary"
                                                        data-bs-toggle="modal"
                                                        data-bs-target="#editPlantModal"
                                                        data-plant-id="@plant.PlantId"
                                                        data-origin="@plant.Origin"
                                                        data-description="@plant.Description"
                                                        data-plant-name="@plant.PlantName"
                                                        data-scientific-name="@plant.ScientificName"
                                                        data-category-id="@plant.CategoryId"        
                                                        data-climate-id="@plant.ClimateId"   
                                                        data-soiltype-ids="@string.Join(',', plant.SoilTypeIds)"
                                                        data-region-ids="@string.Join(',', plant.RegionIds)"
                                                        data-disease-ids="@string.Join(',', plant.DiseaseIds)"
                                                        data-image-url="@plant.ThumbnailUrl"
                                                        data-growth-cycle="@plant.GrowthCycle"
                                                        title="Edit Plant">
                                                        <i class="bi bi-pencil"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-outline-info" data-bs-toggle="tooltip"
                                                        title="View Details">
                                                        <i class="bi bi-eye"></i>
                                                    </button>
                                                    
                                                    <form method="post" asp-page-handler="DeletePLant"
                                                        asp-route-id="@plant.PlantId" class="d-inline"
                                                        onsubmit="return confirm('Are you sure you want to delete this plant?');">
                                                        <button type="submit" class="btn btn-sm btn-outline-danger" title="Delete plant">
                                                            <i class="bi bi-trash"></i>
                                                        </button>
                                                    </form>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                                @await Html.PartialAsync("_Pagination", Model.PlantSummaries, new ViewDataDictionary(ViewData) {
                                    { "RouteName", "/Admin/PlantManagement" }
                                })

                            </div>
                        </div>
                    </div>
                </div>


        @* Form add *@
 <div class="modal fade" id="addPlantModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content wizard-card">
                <div class="wizard-header">
                    <h2 class="wizard-title">Add New Plant</h2>
                    <p class="wizard-subtitle">Complete the form in 4 easy steps to add a new plant to your database</p>
                </div>

                <div class="progress-steps">
                    <div class="step active" data-step="1">
                        <div class="step-circle">1</div>
                        <div class="step-label">Basic Info</div>
                    </div>
                    <div class="step" data-step="2">
                        <div class="step-circle">2</div>
                        <div class="step-label">Environment</div>
                    </div>
                    <div class="step" data-step="3">
                        <div class="step-circle">3</div>
                        <div class="step-label">Health</div>
                    </div>
                    <div class="step" data-step="4">
                        <div class="step-circle">4</div>
                        <div class="step-label">Images & Review</div>
                    </div>
                </div>

                <div class="wizard-content">
                    <form id="addPlantForm" method="post" asp-page-handler="AddPlant">
                        <div class="step-content active" data-step="1">
                            <div class="step-header">
                                <h3 class="step-title">Basic Plant Information</h3>
                                <p class="step-description">Enter the fundamental details about the plant</p>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">Plant Name *</label>
                                        <input type="text" class="form-control-modern" asp-for="AddPlant.PlantName" required placeholder="e.g., Rose">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">Scientific Name *</label>
                                        <input type="text" class="form-control-modern" asp-for="AddPlant.ScientificName" required placeholder="e.g., Rosa rubiginosa">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">Category *</label>
                                        <select class="form-select-modern" asp-for="AddPlant.CategoryId" required>
                                            <option value="">Select Category</option>
                                            @foreach (var cat in Model.Categories)
                                            {
                                                <option value="@cat.CategoryId">@cat.CategoryName</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">Climate *</label>
                                        <select class="form-select-modern" asp-for="AddPlant.ClimateId" required>
                                            <option value="">Select Climate</option>
                                            @foreach (var cli in Model.Climates)
                                            {
                                                <option value="@cli.ClimateId">@cli.ClimateName</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">Growth Cycle *</label>
                                        <select class="form-select-modern" asp-for="AddPlant.GrowthCycle" required>
                                            <option value="">Select Growth Cycle</option>
                                            <option value="annual">Annual (1 year)</option>
                                            <option value="biennial">Biennial (2 years)</option>
                                            <option value="perennial">Perennial (Multiple years)</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">Origin *</label>
                                        <input type="text" class="form-control-modern" asp-for="AddPlant.Origin" required placeholder="e.g., Southeast Asia">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">Description</label>
                                        <textarea class="form-control-modern" asp-for="AddPlant.Description" style="width:100%" rows="3" placeholder="Brief description about the plant"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="step-content" data-step="2">
                            <div class="step-header">
                                <h3 class="step-title">Growth & Environment</h3>
                                <p class="step-description">Select suitable soil types and regions for this plant</p>
                            </div>

                            <div class="row">
                                <!-- Soil Types -->
                                <div class="col-md-6">
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">Soil Types</label>
                                        <div class="checkbox-group">
                                            <div class="checkbox-search">
                                                <input type="text" placeholder="Search soil types..." id="soilSearch">
                                            </div>
                                            <div id="soilList">
                                                @foreach (var soil in Model.SoilTypes)
                                                {
                                                    var inputId = $"soil-{soil.SoilId}";
                                                    <div class="checkbox-item">
                                                        <input type="checkbox" name="AddPlant.SoilTypeIds" value="@soil.SoilId" id="@inputId" />
                                                        <label for="@inputId">@soil.SoilName</label>
                                                    </div>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Regions -->
                                <div class="col-md-6">
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">Regions</label>
                                        <div class="checkbox-group">
                                            <div class="checkbox-search">
                                                <input type="text" placeholder="Search regions..." id="regionSearch">
                                            </div>
                                            <div id="regionList">
                                                @foreach (var region in Model.Regions)
                                                {
                                                    var inputId = $"region-{region.RegionId}";
                                                    <div class="checkbox-item">
                                                        <input type="checkbox" name="AddPlant.RegionIds" value="@region.RegionId" id="@inputId" />
                                                        <label for="@inputId">@region.RegionName</label>
                                                    </div>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="step-content" data-step="3">
                            <div class="step-header">
                                <h3 class="step-title">Plant Health & Diseases</h3>
                                <p class="step-description">Select common diseases and health issues for this plant</p>
                            </div>

                            <div class="form-group-modern">
                                <label class="form-label-modern">Common Diseases</label>
                                <div class="checkbox-group">
                                    <div class="checkbox-search">
                                        <input type="text" placeholder="Search diseases..." id="diseaseSearch">
                                    </div>
                                    <div id="diseaseList">
                                        @foreach (var disease in Model.Diseases)
                                        {
                                            var inputId = $"disease-{disease.DiseaseId}";
                                            <div class="checkbox-item">
                                                <input type="checkbox" name="AddPlant.DiseaseIds" value="@disease.DiseaseId" id="@inputId" />
                                                <label for="@inputId">@disease.DiseaseName</label>
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="step-content" data-step="4">
                            <div class="step-header">
                                <h3 class="step-title">Images & Final Review</h3>
                                <p class="step-description">Upload plant images and review all information</p>
                            </div>

                            <div class="form-group-modern">
                                <label class="form-label-modern">Plant Images</label>
                                <div class="image-upload-area" id="imageUploadArea">
                                    <div class="upload-icon">
                                        <i class="bi bi-cloud-upload"></i>
                                    </div>
                                    <div class="upload-text">Drag & drop images here or click to browse</div>
                                    <div class="upload-subtext">Supports: JPG, PNG, WebP (Max 5MB each)</div>
                                    <input type="file" id="imageInput" name="images[]" multiple accept="image/*">
                                </div>
                                <div  class="mt-3 imagePreview"></div>
                            </div>

                            <div class="review-section">
                                <h4 class="review-title">Review Plant Information</h4>
                                <div id="reviewContentAdd">
                                     Review content will be populated by JavaScript 
                                </div>
                            </div>
                        </div>
                        <div class="wizard-navigation">
                            <button type="button" class="btn-wizard btn-wizard-secondary prevBtn" style="display: none;">
                                <i class="bi bi-arrow-left me-2"></i>Previous
                            </button>
                            <div class="ms-auto d-flex gap-2">
                                <button type="button" class="btn-wizard btn-wizard-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn-wizard btn-wizard-primary nextBtn">
                                    Next<i class="bi bi-arrow-right ms-2"></i>
                                </button>
                                <button type="submit" form="addPlantForm" class="btn-wizard btn-wizard-primary submitBtn" style="display: none;">
                                    Submit
                                </button>
                                
                            </div>
                        </div>
                    </form>
                </div>
                
            </div>
        </div>
    </div>


    @* form edit *@
     <div class="modal fade" id="editPlantModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content wizard-card">
            <div class="wizard-header">
                <h2 class="wizard-title">Edit Plant</h2>
                <p class="wizard-subtitle">Update the plant’s information in 4 easy steps</p>
            </div>

                <div class="progress-steps">
                    <div class="step active" data-step="1">
                        <div class="step-circle">1</div>
                        <div class="step-label">Basic Info</div>
                    </div>
                    <div class="step" data-step="2">
                        <div class="step-circle">2</div>
                        <div class="step-label">Environment</div>
                    </div>
                    <div class="step" data-step="3">
                        <div class="step-circle">3</div>
                        <div class="step-label">Health</div>
                    </div>
                    <div class="step" data-step="4">
                        <div class="step-circle">4</div>
                        <div class="step-label">Images & Review</div>
                    </div>
                </div>

                <div class="wizard-content">
                    <form id="editPlantForm" method="post" asp-page-handler="EditPlant">
                     <input type="hidden" name="EditPlant.PlantId" id="editPlantId" value="" />
                        <div class="step-content active" data-step="1">
                            <div class="step-header">
                                <h3 class="step-title">Basic Plant Information</h3>
                                <p class="step-description">Enter the fundamental details about the plant</p>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">Plant Name *</label>
                                        <input type="text" class="form-control-modern" asp-for="EditPlant.PlantName" id="editPlantName" required placeholder="e.g., Rose">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">Scientific Name *</label>
                                        <input type="text" class="form-control-modern" asp-for="EditPlant.ScientificName" id="editScientificName" required placeholder="e.g., Rosa rubiginosa">
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">Category *</label>
                                        <select class="form-select-modern" asp-for="EditPlant.CategoryId" id="editCategoryId" required>
                                            <option value="">Select Category</option>
                                            @foreach (var cat in Model.Categories)
                                            {
                                                <option value="@cat.CategoryId">@cat.CategoryName</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">Climate *</label>
                                        <select class="form-select-modern" asp-for="EditPlant.ClimateId" id="editClimateId" required>
                                            <option value="">Select Climate</option>
                                            @foreach (var cli in Model.Climates)
                                            {
                                                <option value="@cli.ClimateId">@cli.ClimateName</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">Growth Cycle *</label>
                                        <select class="form-select-modern" asp-for="EditPlant.GrowthCycle" id="editPLantGrowCycle" required>
                                            <option value="">Select Growth Cycle</option>
                                            <option value="annual">Annual (1 year)</option>
                                            <option value="biennial">Biennial (2 years)</option>
                                            <option value="perennial">Perennial (Multiple years)</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">Origin *</label>
                                        <input type="text" class="form-control-modern" asp-for="EditPlant.Origin" id="editOrigin" required placeholder="e.g., Southeast Asia">
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">Description</label>
                                        <textarea class="form-control-modern w-100" asp-for="EditPlant.Description" id="editDescription" rows="3" placeholder="Brief description about the plant"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="step-content" data-step="2">
                            <div class="step-header">
                                <h3 class="step-title">Growth & Environment</h3>
                                <p class="step-description">Select suitable soil types and regions for this plant</p>
                            </div>
                            <div class="row">
                                <!-- Soil Types -->
                                <div class="col-md-6">
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">Soil Types</label>
                                        <div class="checkbox-group">
                                            <div class="checkbox-search">
                                                <input type="text" placeholder="Search soil types..." id="editSoilSearch">
                                            </div>
                                            <div id="editSoilList">
                                                @foreach (var soil in Model.SoilTypes)
                                                {
                                                    var inputId = $"edit-soil-{soil.SoilId}";
                                                    <div class="checkbox-item">
                                                        <input type="checkbox" name="EditPlant.SoilTypeIds" value="@soil.SoilId" id="@inputId" />
                                                        <label for="@inputId">@soil.SoilName</label>
                                                    </div>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Regions -->
                                <div class="col-md-6">
                                    <div class="form-group-modern">
                                        <label class="form-label-modern">Regions</label>
                                        <div class="checkbox-group">
                                            <div class="checkbox-search">
                                                <input type="text" placeholder="Search regions..." id="editRegionSearch">
                                            </div>
                                            <div id="editRegionList">
                                                @foreach (var region in Model.Regions)
                                                {
                                                    var inputId = $"edit-region-{region.RegionId}";
                                                    <div class="checkbox-item">
                                                        <input type="checkbox" name="EditPlant.RegionIds" value="@region.RegionId" id="@inputId" />
                                                        <label for="@inputId">@region.RegionName</label>
                                                    </div>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="step-content" data-step="3">
                            <div class="step-header">
                                <h3 class="step-title">Plant Health & Diseases</h3>
                                <p class="step-description">Select common diseases and health issues for this plant</p>
                            </div>

                            <div class="form-group-modern">
                                <label class="form-label-modern">Common Diseases</label>
                                <div class="checkbox-group">
                                    <div class="checkbox-search">
                                        <input type="text" placeholder="Search diseases..." id="diseaseSearch">
                                    </div>
                                    <div id="diseaseList">
                                        @foreach (var disease in Model.Diseases)
                                        {
                                            var inputId = $"disease-{disease.DiseaseId}";
                                            <div class="checkbox-item">
                                                <input type="checkbox" name="EditPlant.DiseaseIds" value="@disease.DiseaseId" id="@inputId" />
                                                <label for="@inputId">@disease.DiseaseName</label>
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="step-content" data-step="4">
                            <div class="step-header">
                                <h3 class="step-title">Images & Final Review</h3>
                                <p class="step-description">Upload plant images and review all information</p>
                            </div>

                            <div class="form-group-modern">
                                <label class="form-label-modern">Plant Images</label>
                                <div class="image-upload-area" id="imageUploadArea">
                                    <div class="upload-icon">
                                        <i class="bi bi-cloud-upload"></i>
                                    </div>
                                    <div class="upload-text">Drag & drop images here or click to browse</div>
                                    <div class="upload-subtext">Supports: JPG, PNG, WebP (Max 5MB each)</div>
                                    <input type="file" id="imageInput" name="images[]" multiple accept="image/*">
                                </div>
                                <div id="imagePreview" class="mt-3"></div>
                            </div>

                            <div class="review-section">
                                <h4 class="review-title">Review Plant Information</h4>
                                <div id="reviewContentEdit">
                                     Review content will be populated by JavaScript 
                                </div>
                            </div>
                        </div>                        
                        <div class="wizard-navigation">
                            <button type="button" class="btn-wizard btn-wizard-secondary prevBtn" style="display: none;">
                                <i class="bi bi-arrow-left me-2"></i>Previous
                            </button>
                            <div class="ms-auto d-flex gap-2">
                                <button type="button" class="btn-wizard btn-wizard-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn-wizard btn-wizard-primary nextBtn">
                                    Next<i class="bi bi-arrow-right ms-2"></i>
                                </button>
                                <button type="submit" form="editPlantForm" class="btn-wizard btn-wizard-primary submitBtn" style="display: none;">
                                    Submit
                                </button>
                                
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  var editModal = document.getElementById("editPlantModal");
  if (editModal) {
    editModal.addEventListener("show.bs.modal", function (event) {
      var button = event.relatedTarget;

      // Lấy data từ nút Edit
      var plantId = button.getAttribute("data-plant-id");
      var plantName = button.getAttribute("data-plant-name");
      var scientificName = button.getAttribute("data-scientific-name");
      var categoryId = button.getAttribute("data-category-id");
      var climateId = button.getAttribute("data-climate-id");
      var growthCycle = button.getAttribute("data-growth-cycle");
      var soilTypeIds = (button.getAttribute("data-soiltype-ids")||"").split(",");
      var regionIds = (button.getAttribute("data-region-ids")||"").split(",");
      var diseaseIds = (button.getAttribute("data-disease-ids")||"").split(",");
      var origin = button.getAttribute("data-origin");
      var description = button.getAttribute("data-description");

      // Fill các trường input/select
      editModal.querySelector('input[name="EditPlant.PlantId"]').value = plantId || "";
      editModal.querySelector('input[name="EditPlant.PlantName"]').value = plantName || "";
      editModal.querySelector('input[name="EditPlant.ScientificName"]').value = scientificName || "";
      editModal.querySelector('select[name="EditPlant.CategoryId"]').value = categoryId || "";
      editModal.querySelector('select[name="EditPlant.ClimateId"]').value = climateId || "";
      editModal.querySelector('select[name="EditPlant.GrowthCycle"]').value = growthCycle || "";
      editModal.querySelector('input[name="EditPlant.Origin"]').value = origin || "";
      editModal.querySelector('textarea[name="EditPlant.Description"]').value = description || "";

      // Bỏ chọn tất cả trước khi set lại
      editModal.querySelectorAll('input[name="EditPlant.SoilTypeIds"]').forEach(cb => cb.checked = false);
      editModal.querySelectorAll('input[name="EditPlant.RegionIds"]').forEach(cb => cb.checked = false);
      editModal.querySelectorAll('input[name="EditPlant.DiseaseIds"]').forEach(cb => cb.checked = false);

      // Chọn lại các checkbox đúng giá trị
      soilTypeIds.forEach(function (id) {
        var cb = editModal.querySelector('input[name="EditPlant.SoilTypeIds"][value="' + id + '"]');
        if (cb) cb.checked = true;
      });
      regionIds.forEach(function (id) {
        var cb = editModal.querySelector('input[name="EditPlant.RegionIds"][value="' + id + '"]');
        if (cb) cb.checked = true;
      });
      diseaseIds.forEach(function (id) {
        var cb = editModal.querySelector('input[name="EditPlant.DiseaseIds"][value="' + id + '"]');
        if (cb) cb.checked = true;
      });
    });
  }
});
</script>
