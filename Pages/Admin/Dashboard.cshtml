@page
@model PlantsInformationWeb.Pages.Admin.Dashboard
@{
    Layout = "_LayoutAdmin";
    ViewData["Title"] = "Admin Dashboard";
}

<head>
    <link rel="stylesheet" href="~/css/dashboard.css" />
</head>

<div id="dashboard-section" class="dashboard-container">
    <!-- Modern Dashboard Header with Gradient Background -->
    <div class="dashboard-header">
        <div class="header-content">
            <div class="header-text">
                <h1 class="dashboard-title">
                    <i class="bi bi-grid-3x3-gap me-2"></i>Dashboard Overview
                </h1>
                <p class="dashboard-subtitle">
                    <i class="bi bi-calendar3 me-2"></i>
                    Welcome back! Here's what's happening with your plant database today.
                </p>
            </div>
        </div>
    </div>

    <!-- Modern Statistics Grid with Gradient Cards -->
    <div class="stats-grid">
        <!-- Users Card -->
        <div class="stat-card-modern" data-aos="fade-up" data-aos-delay="0">
            <div class="stat-card-content">
                <div class="stat-icon-wrapper stat-icon-users">
                    <i class="bi bi-people-fill"></i>
                </div>
                <div class="stat-details">
                    <span class="stat-label">Total Users</span>
                    <h3 class="stat-value">@Model.TotalUser</h3>
                    <div class="stat-footer">
                        <span class="stat-change positive">
                            <i class="bi bi-arrow-up-short"></i>
                            <span>12% increase</span>
                        </span>
                        <span class="stat-period">vs last month</span>
                    </div>
                </div>
            </div>
            <div class="stat-card-decoration"></div>
        </div>

        <!-- Plants Card -->
        <div class="stat-card-modern" data-aos="fade-up" data-aos-delay="100">
            <div class="stat-card-content">
                <div class="stat-icon-wrapper stat-icon-plants">
                    <i class="bi bi-flower2"></i>
                </div>
                <div class="stat-details">
                    <span class="stat-label">Total Plants</span>
                    <h3 class="stat-value">@Model.TotalPlant</h3>
                    <div class="stat-footer">
                        <span class="stat-change positive">
                            <i class="bi bi-arrow-up-short"></i>
                            <span>8% increase</span>
                        </span>
                        <span class="stat-period">vs last month</span>
                    </div>
                </div>
            </div>
            <div class="stat-card-decoration"></div>
        </div>

        <!-- Categories Card -->
        <div class="stat-card-modern" data-aos="fade-up" data-aos-delay="200">
            <div class="stat-card-content">
                <div class="stat-icon-wrapper stat-icon-categories">
                    <i class="bi bi-tags-fill"></i>
                </div>
                <div class="stat-details">
                    <span class="stat-label">Categories</span>
                    <h3 class="stat-value">@Model.TotalCategory</h3>
                    <div class="stat-footer">
                        <span class="stat-change neutral">
                            <i class="bi bi-dash"></i>
                            <span>No change</span>
                        </span>
                        <span class="stat-period">this month</span>
                    </div>
                </div>
            </div>
            <div class="stat-card-decoration"></div>
        </div>

        <!-- Regions Card -->
        <div class="stat-card-modern" data-aos="fade-up" data-aos-delay="300">
            <div class="stat-card-content">
                <div class="stat-icon-wrapper stat-icon-regions">
                    <i class="bi bi-globe-americas"></i>
                </div>
                <div class="stat-details">
                    <span class="stat-label">Regions</span>
                    <h3 class="stat-value">@Model.TotalRegion</h3>
                    <div class="stat-footer">
                        <span class="stat-change positive">
                            <i class="bi bi-arrow-up-short"></i>
                            <span>2 new regions</span>
                        </span>
                        <span class="stat-period">added</span>
                    </div>
                </div>
            </div>
            <div class="stat-card-decoration"></div>
        </div>

        <!-- Soil Types Card -->
        <div class="stat-card-modern" data-aos="fade-up" data-aos-delay="400">
            <div class="stat-card-content">
                <div class="stat-icon-wrapper stat-icon-soil">
                    <i class="bi bi-layers-fill"></i>
                </div>
                <div class="stat-details">
                    <span class="stat-label">Soil Types</span>
                    <h3 class="stat-value">@Model.TotalSoilType</h3>
                    <div class="stat-footer">
                        <span class="stat-change neutral">
                            <i class="bi bi-dash"></i>
                            <span>Stable</span>
                        </span>
                        <span class="stat-period">this month</span>
                    </div>
                </div>
            </div>
            <div class="stat-card-decoration"></div>
        </div>

        <!-- Diseases Card -->
        <div class="stat-card-modern" data-aos="fade-up" data-aos-delay="500">
            <div class="stat-card-content">
                <div class="stat-icon-wrapper stat-icon-diseases">
                    <i class="bi bi-bug-fill"></i>
                </div>
                <div class="stat-details">
                    <span class="stat-label">Diseases</span>
                    <h3 class="stat-value">@Model.TotalDisease</h3>
                    <div class="stat-footer">
                        <span class="stat-change negative">
                            <i class="bi bi-arrow-down-short"></i>
                            <span>3 resolved</span>
                        </span>
                        <span class="stat-period">this week</span>
                    </div>
                </div>
            </div>
            <div class="stat-card-decoration"></div>
        </div>
    </div>

    <!-- Charts Section with Modern Card Design -->
    <div class="charts-section">
        <div class="section-header">
            <div>
                <h2 class="section-title">
                    <i class="bi bi-bar-chart-line me-2"></i>Analytics & Insights
                </h2>
                <p class="section-subtitle">Visual representation of your plant database statistics</p>
            </div>
        </div>

        <!-- First Row: Pie and Doughnut Charts -->
        <div class="row g-4 mb-4">
            <div class="col-lg-6" data-aos="fade-up" data-aos-delay="100">
                <div class="chart-card">
                    <div class="chart-card-header">
                        <div class="chart-header-content">
                            <div class="chart-icon-badge">
                                <i class="bi bi-pie-chart-fill"></i>
                            </div>
                            <div>
                                <h5 class="chart-title">Plants by Category</h5>
                                <p class="chart-subtitle">Distribution across all categories</p>
                            </div>
                        </div>
                    </div>
                    <div class="chart-card-body">
                        <canvas id="categoryPieChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="col-lg-6" data-aos="fade-up" data-aos-delay="200">
                <div class="chart-card">
                    <div class="chart-card-header">
                        <div class="chart-header-content">
                            <div class="chart-icon-badge">
                                <i class="bi bi-brightness-high-fill"></i>
                            </div>
                            <div>
                                <h5 class="chart-title">Plants by Climate</h5>
                                <p class="chart-subtitle">Climate zone distribution</p>
                            </div>
                        </div>
                    </div>
                    <div class="chart-card-body">
                        <canvas id="climateDoughnutChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Second Row: Bar Chart -->
        <div class="row g-4 mb-4">
            <div class="col-12" data-aos="fade-up" data-aos-delay="300">
                <div class="chart-card">
                    <div class="chart-card-header">
                        <div class="chart-header-content">
                            <div class="chart-icon-badge">
                                <i class="bi bi-bar-chart-fill"></i>
                            </div>
                            <div>
                                <h5 class="chart-title">Plants by Region</h5>
                                <p class="chart-subtitle">Regional distribution of plant species</p>
                            </div>
                        </div>
                    </div>
                    <div class="chart-card-body">
                        <canvas id="regionBarChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Third Row: Line Charts -->
        <div class="row g-4 mb-4">
            <div class="col-lg-6" data-aos="fade-up" data-aos-delay="400">
                <div class="chart-card">
                    <div class="chart-card-header">
                        <div class="chart-header-content">
                            <div class="chart-icon-badge">
                                <i class="bi bi-graph-up"></i>
                            </div>
                            <div>
                                <h5 class="chart-title">User Registrations</h5>
                                <p class="chart-subtitle">New users over the last 12 months</p>
                            </div>
                        </div>
                    </div>
                    <div class="chart-card-body">
                        <canvas id="userRegistrationChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="col-lg-6" data-aos="fade-up" data-aos-delay="500">
                <div class="chart-card">
                    <div class="chart-card-header">
                        <div class="chart-header-content">
                            <div class="chart-icon-badge">
                                <i class="bi bi-graph-up-arrow"></i>
                            </div>
                            <div>
                                <h5 class="chart-title">New Plants Added</h5>
                                <p class="chart-subtitle">Plant additions over the last 12 months</p>
                            </div>
                        </div>
                    </div>
                    <div class="chart-card-body">
                        <canvas id="plantAdditionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="activity-section" data-aos="fade-up" data-aos-delay="600">
        <div class="section-header">
            <div>
                <h2 class="section-title">
                    <i class="bi bi-search me-2"></i>Unrecognized Plants (AI Suggestions)
                </h2>
                <p class="section-subtitle">Plants users asked but not found in database</p>
            </div>
        </div>

        <div class="activity-card">
            <div class="table-responsive" id="unrecognizedPlantsTableContainer">
                @await Html.PartialAsync(partialViewName: "_UnrecognizedPlantsTable", Model.unPlant)
            </div>
        </div>
    </div>
</div>

<!-- Modal xác nhận xóa với theme cây trồng -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0" style="border-radius: 16px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);">
            <!-- Header với gradient xanh lá cây -->
            <div class="modal-header border-0"
                style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 16px 16px 0 0; padding: 24px;">
                <div class="d-flex align-items-center gap-3">
                    <div
                        style="width: 48px; height: 48px; background: rgba(255, 255, 255, 0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                        <i class="bi bi-exclamation-triangle-fill" style="font-size: 24px; color: white;"></i>
                    </div>
                    <h5 class="modal-title mb-0" style="color: white; font-weight: 600; font-size: 18px;">Xác nhận xóa
                        danh mục</h5>
                </div>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body" style="padding: 28px;">
                <p style="margin-bottom: 12px; color: #1f2937; font-size: 15px;">
                    Bạn có chắc chắn muốn xóa danh mục <strong style="color: #059669;" id="deleteName"></strong>?
                </p>
                <p style="margin: 0; color: #6b7280; font-size: 13px; line-height: 1.5;">
                    <i class="bi bi-info-circle me-2" style="color: #10b981;"></i>
                    Hành động này không thể hoàn tác. Vui lòng cân nhắc kỹ trước khi xóa.
                </p>
            </div>

            <div class="modal-footer border-top"
                style="border-top-color: #e5e7eb !important; padding: 16px 28px; gap: 12px;">
                <button type="button" class="btn" data-bs-dismiss="modal"
                    style="background-color: #f3f4f6; color: #374151; border: none; border-radius: 8px; padding: 8px 20px; font-weight: 500; transition: all 0.2s;">Hủy</button>
                <button type="button" class="btn" id="confirmDeleteBtn"
                    style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none; border-radius: 8px; padding: 8px 20px; font-weight: 500; transition: all 0.2s;"
                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 10px 20px rgba(239, 68, 68, 0.3)';"
                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">Xóa</button>
            </div>
        </div>
    </div>
</div>


<!-- Keep existing Chart.js and dashboard.js references -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="~/js/dashboard.js"></script>
<script>
    $(document).on('click', '.pagination-link', function (e) {
        e.preventDefault();
        var url = $(this).attr('href');
        var containerId = $(this).data('container') || '#unrecognizedPlantsTableContainer';
        $.get(url, function (data) {
            $(containerId).html(data);
        });
    });

    function handleUnrecognizedPlant(id, name) {

        showConfirmModal(name, function () {
            deleteUnrecognizedPlant(id);
        });
    }

    function deleteUnrecognizedPlant(id) {
        console.log("Đang xóa cây có id:", id);
        var pageIndex = $('.pagination-link.active').data('page') || 1;
        var url = '/Admin/Dashboard?handler=DeleteUnrecognizedPlant';
        var token = getAntiForgeryToken();

        $.ajax({
            url: url,
            type: 'POST',
            data: {
                id: id,
                pageIndex: pageIndex,
                __RequestVerificationToken: token
            },
            success: function (data) {
                $('#unrecognizedPlantsTableContainer').html(data);

                // Đóng modal xác nhận xóa
                const modalElement = document.getElementById('deleteConfirmModal');
                if (modalElement) {
                    const modalInstance = bootstrap.Modal.getInstance(modalElement);
                    if (modalInstance) modalInstance.hide();
                }

                // Hiển thị thông báo thành công
                showNotification('success', 'Xóa cây khỏi danh sách thành công!');
            },
            error: function (xhr) {
                // Đóng modal xác nhận xóa (nếu muốn)
                const modalElement = document.getElementById('deleteConfirmModal');
                if (modalElement) {
                    const modalInstance = bootstrap.Modal.getInstance(modalElement);
                    if (modalInstance) modalInstance.hide();
                }

                // Hiển thị thông báo lỗi
                showNotification('error', 'Xóa cây thất bại! ' + (xhr.responseText || ''));
            }
        });
    }


</script>